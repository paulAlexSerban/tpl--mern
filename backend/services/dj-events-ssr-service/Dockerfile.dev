FROM wbk--mern-playground__core:latest as builder

COPY ./backend/services/dj-events-ssr-service ./backend/services/dj-events-ssr-service

ARG CONTAINER_PORT
ARG NEXT_PUBLIC_PROTOCOL
ARG NEXT_PUBLIC_HOSTNAME
ARG NEXT_PUBLIC_API_URL
ARG CMS_URL
ARG NEXT_PUBLIC_APP_URL

ENV NEXT_PUBLIC_PROTOCOL=$NEXT_PUBLIC_PROTOCOL
ENV NEXT_PUBLIC_HOSTNAME=$NEXT_PUBLIC_HOSTNAME
ENV PORT=$CONTAINER_PORT
ENV NEXT_PUBLIC_PORT=$CONTAINER_PORT
ENV NEXT_PUBLIC_APP_URL=$NEXT_PUBLIC_APP_URL
ENV NEXT_PUBLIC_CMS_API_URL=$CMS_URL
ENV NEXT_PUBLIC_API_URL=$NEXT_PUBLIC_API_URL

EXPOSE $CONTAINER_PORT

RUN yarn install

CMD [ "yarn", "develop:dj-events-ssr-service"]